{% extends 'base.html' %}

{% block content %}

<h2 class="timer"></h2>
<form action="/action_page.php">
    <label for="pin">Pin</label>
    <input type="text" id="pin" name="pin"><br><br>
    <input type="submit" value="Submit">
  </form>
<script>
    document.addEventListener('DOMContentLoaded', function(){
        let time = parseInt('{{ timer|safe }}', 10);  
        console.log(`Starting countdown from: ${time} minutes`);

        function startCountdown(minutes) {
            let totalSeconds = minutes * 60;


            const timerInterval = setInterval(() => {
                // Calculate minutes and seconds
                const mins = Math.floor(totalSeconds / 60);
                const secs = totalSeconds % 60;

                const formattedTime = `${mins}:${secs < 10 ? '0' : ''}${secs}`;

                // Update the timer div
                let timerDiv = document.querySelector('.timer');
                if (timerDiv) {
                    timerDiv.textContent = formattedTime;  //Display ctime
                }

                // Stop the timer when it reaches 0
                if (totalSeconds === 0) {
                    clearInterval(timerInterval);
                    console.log("Time's up!");
                }

                totalSeconds--;
            }, 1000);
        }

        // Start the countdown using the time variable
        startCountdown(time);
    });
</script>

{% endblock %}