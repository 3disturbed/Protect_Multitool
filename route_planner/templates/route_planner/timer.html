{% extends 'base.html' %}

{% block content %}

<h2 class="timer"></h2>
<form action="/action_page.php">
    <label for="pin">Pin</label>
    <input type="text" id="pin" name="pin"><br><br>
    <input type="submit" value="Submit">
  </form>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
        // Safely pass the initial time value (in minutes) from Django to JavaScript
        const initialTime = parseInt('{{ timer|safe }}', 10);  // Parse as integer
        console.log(`Initial time: ${initialTime} minutes`);

        // Retrieve the remaining time from localStorage, or set to initial value
        let remainingSeconds = localStorage.getItem('remainingSeconds');
        if (!remainingSeconds) {
            remainingSeconds = initialTime * 60;  // Convert minutes to seconds
            localStorage.setItem('remainingSeconds', remainingSeconds);
        }

        function startCountdown() {
            const timerInterval = setInterval(() => {
                // Retrieve the remaining time from localStorage
                let seconds = parseInt(localStorage.getItem('remainingSeconds'), 10);

                // Calculate minutes and seconds
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;

                // Format time as MM:SS
                const formattedTime = `${mins}:${secs < 10 ? '0' : ''}${secs}`;

                // Update the timer div
                let timerDiv = document.querySelector('.timer');
                if (timerDiv) {
                    timerDiv.textContent = formattedTime;  // Display time
                }

                // Stop the timer when it reaches 0
                if (seconds <= 0) {
                    clearInterval(timerInterval);
                    console.log("Time's up!");
                    localStorage.removeItem('remainingSeconds'); // Clear storage
                } else {
                    // Decrement and update the remaining time in localStorage
                    seconds--;
                    localStorage.setItem('remainingSeconds', seconds);
                }
            }, 1000); // Run every 1 second
        }

        // Start the countdown
        startCountdown();
    });
</script>


{% endblock %}