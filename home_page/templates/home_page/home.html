{# home_page/templates/home_page/home.html #}
{% extends 'base.html' %}

{% block title %}Welcome - Protect Multi-Tool{% endblock %}

{% block content %}

<!-- Hero Section (slight glowing animation)-->
<div class="relative overflow-hidden rounded-3xl mb-12">
    <div class="absolute inset-0 bg-gradient-to-r from-accent/10 to-secondary/10 animate-pulse"></div>
    <div class="relative z-10 flex flex-col items-center justify-center py-16 px-4">
        <h1 class="text-5xl md:text-6xl text-center font-bold bg-gradient-to-r from-accent to-secondary bg-clip-text text-transparent mb-6">
            Protect Multi-Tool
        </h1>
        <p class="text-xl md:text-2xl text-center font-bold text-gray-300 mb-8 max-w-2xl">
            Your personal safety companion in the fight against human trafficking
        </p>
        
        <!-- Statistics Row -->
        <div class="flex flex-wrap justify-center gap-4 mt-4">
            <div class="backdrop-blur-md bg-neutral-light/30 rounded-xl px-6 py-3 border border-accent/10 animate-fade-in">
                <span class="text-2xl font-bold text-accent">40M+</span>
                <span class="text-gray-300 ml-2">People at risk globally</span>
            </div>
            <div class="backdrop-blur-md bg-neutral-light/30 rounded-xl px-6 py-3 border border-accent/10 animate-fade-in delay-100">
                <span class="text-2xl font-bold text-secondary">24/7</span>
                <span class="text-gray-300 ml-2">Protection active</span>
            </div>
            <div class="backdrop-blur-md bg-neutral-light/30 rounded-xl px-6 py-3 border border-accent/10 animate-fade-in delay-200">
                <span class="text-2xl font-bold text-accent">100%</span>
                <span class="text-gray-300 ml-2">Confidential</span>
            </div>
        </div>
    </div>
</div>

<!-- Sign-in Reminder -->
{% if not user.is_authenticated %}
<div class="backdrop-blur-md bg-accent/10 text-white text-center p-6 rounded-xl mb-8 border border-accent/20">
    <p class="text-lg font-medium">
        Take control of your safety today. 
        <a href="{% url 'account_login' %}" class="font-bold text-accent hover:text-accent-light transition-colors">Sign in</a> or
        <a href="{% url 'account_signup' %}" class="font-bold text-accent hover:text-accent-light transition-colors">register</a> 
        to access our full suite of protection tools.
    </p>
</div>
{% endif %}

<!-- Features Grid -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
    <!-- Game Feature -->
    <div class="group backdrop-blur-md bg-neutral-light/30 rounded-2xl p-6 shadow-xl border border-accent/10 transition-all hover:bg-neutral-light/40 hover:scale-[1.02]">
        <div class="flex items-center space-x-3 mb-4">
            <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center group-hover:bg-accent/30 transition-all">
                <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <h2 class="text-xl font-bold">Safety Games</h2>
        </div>
        <p class="mb-4 text-gray-300">Use our discreet gaming interface to send emergency messages to your trusted contacts</p>
        <a href="{% url 'game:home' %}" class="inline-flex items-center text-accent group-hover:text-accent-light transition-colors">
            Try it out 
            <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </a>
    </div>

    <!-- Route Planner Feature -->
    <div class="group backdrop-blur-md bg-neutral-light/30 rounded-2xl p-6 shadow-xl border border-accent/10 transition-all hover:bg-neutral-light/40 hover:scale-[1.02]">
        <div class="flex items-center space-x-3 mb-4">
            <div class="w-12 h-12 rounded-xl bg-secondary/20 flex items-center justify-center group-hover:bg-secondary/30 transition-all">
                <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                </svg>
            </div>
            <h2 class="text-xl font-bold">Route Planner</h2>
        </div>
        <p class="mb-4 text-gray-300">Plan and share your travel routes with trusted contacts for enhanced journey safety</p>
        <a href="{% url 'route_planner:home' %}" class="inline-flex items-center text-accent group-hover:text-accent-light transition-colors">
            Plan route 
            <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </a>
    </div>

    <!-- Account Feature -->
    <div class="group backdrop-blur-md bg-neutral-light/30 rounded-2xl p-6 shadow-xl border border-accent/10 transition-all hover:bg-neutral-light/40 hover:scale-[1.02]">
        <div class="flex items-center space-x-3 mb-4">
            <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center group-hover:bg-accent/30 transition-all">
                <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </div>
            <h2 class="text-xl font-bold">Your Account</h2>
        </div>
        <p class="mb-4 text-gray-300">Manage your emergency contacts and customize your safety settings</p>
        <a href="{% url 'account_home:emergency_contact_list' %}" class="inline-flex items-center text-accent group-hover:text-accent-light transition-colors">
            Go to account 
            <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </a>
    </div>
</div>


<!-- Emergency Button Section -->
<div class="relative">
    {% if user.is_authenticated %}
        {% if emergency_contacts_check %}
            <button id="emergencyBtnDesktop" class="group w-full px-4 py-10 bg-gradient-to-r from-red-500 to-red-600 text-2xl text-white rounded-xl transition-all transform hover:scale-[1.02] hover:shadow-lg relative overflow-hidden">
                <span class="relative z-10 font-bold tracking-wider">EMERGENCY</span>
                <div class="absolute inset-0 bg-red-500 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></div>
            </button>
        {% else %}
            <a href="{% url 'account_home:add_emergency_contact' %}" class="group w-full px-4 py-10 bg-gradient-to-r from-amber-500 to-amber-600 text-2xl text-white rounded-xl transition-all transform hover:scale-[1.02] hover:shadow-lg text-center block">
                <span class="font-bold tracking-wider">ADD CONTACTS</span>
            </a>
        {% endif %}
    {% else %}
        <a href="{% url 'account_signup' %}" class="group w-full px-4 py-10 bg-gradient-to-r from-green-500 to-green-600 text-2xl text-white rounded-xl transition-all transform hover:scale-[1.02] hover:shadow-lg text-center block">
            <span class="font-bold tracking-wider">Sign Up / Log In</span>
        </a>
    {% endif %}
</div>


<!-- Our Mission -->
<div class="mt-12 backdrop-blur-md bg-neutral-light/30 rounded-2xl p-8 shadow-xl border border-accent/10">
    <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl font-bold mb-6 bg-gradient-to-r from-accent to-secondary bg-clip-text text-transparent">Our Mission</h2>
        <p class="text-lg text-gray-300 mb-8 leading-relaxed">
            In recognition of Human Trafficking Prevention Month, Protect Multitool is dedicated to empowering individuals through innovative safety solutions. We leverage technology to create discreet, accessible tools that enhance personal security and raise awareness about human trafficking and modern slavery.
        </p>
        <div class="flex flex-wrap justify-center gap-4">
            <div class="flex items-center space-x-2 bg-accent/10 rounded-full px-4 py-2">
                <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
                <span class="text-sm text-white">Safety First</span>
            </div>
            <div class="flex items-center space-x-2 bg-secondary/10 rounded-full px-4 py-2">
                <svg class="w-5 h-5 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4"/>
                </svg>
                <span class="text-sm text-white">Privacy Protected</span>
            </div>
            <div class="flex items-center space-x-2 bg-accent/10 rounded-full px-4 py-2">
                <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                <span class="text-sm text-white">Quick Response</span>
            </div>
        </div>
        <a href="{% url 'home_page:about' %}" class="inline-flex items-center mt-8 text-accent hover:text-accent-light transition-colors group">
            <span class="text-xl font-bold">Learn More</span>
            <svg class="w-5 h-5 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </a>
    </div>
</div>

    <!-- Features Section with Icons -->
    <div class="mb-16 p-12">
        <div class="text-center max-w-3xl mx-auto mb-12 p-8">
            <h2 class="text-3xl font-bold mb-4 bg-gradient-to-r from-accent to-secondary bg-clip-text text-transparent">
                Innovative Protection Tools
            </h2>
            <p class="text-gray-300">
                In today's world, personal safety requires sophisticated yet discreet solutions. Our multi-tool approach combines 
                everyday functionality with powerful emergency features, ensuring you're always protected without drawing unwanted attention.
            </p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">
            <div class="group backdrop-blur-md bg-neutral-light/30 rounded-2xl p-8 hover:bg-neutral-light/40 transition-all border border-accent/10">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center group-hover:bg-accent/30 transition-all">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold ml-4 text-white">Location Tracking</h3>
                </div>
                <p class="text-gray-300">Real-time location sharing with trusted contacts and automatic notifications for missed check-ins.</p>
            </div>

            <div class="group backdrop-blur-md bg-neutral-light/30 rounded-2xl p-8 hover:bg-neutral-light/40 transition-all border border-accent/10">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 rounded-xl bg-secondary/20 flex items-center justify-center group-hover:bg-secondary/30 transition-all">
                        <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold ml-4 text-white">Emergency SOS</h3>
                </div>
                <p class="text-gray-300">Discrete emergency alerts with one-touch activation and immediate location sharing.</p>
            </div>

            <div class="group backdrop-blur-md bg-neutral-light/30 rounded-2xl p-8 hover:bg-neutral-light/40 transition-all border border-accent/10">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center group-hover:bg-accent/30 transition-all">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold ml-4 text-white">Journey Planning</h3>
                </div>
                <p class="text-gray-300">Detailed journey logging with automated check-ins and route tracking.</p>
            </div>
            
            <div class="group backdrop-blur-md bg-neutral-light/30 rounded-2xl p-8 hover:bg-neutral-light/40 transition-all border border-accent/10">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 rounded-xl bg-secondary/20 flex items-center justify-center group-hover:bg-secondary/30 transition-all">
                        <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold ml-4 text-white">Discreet Game Mode</h3>
                </div>
                <div class="space-y-2">
                    <p class="text-gray-300">A disguised safety feature that appears as a casual game but contains a hidden emergency alert system.</p>
                    <div class="pt-2 border-t border-secondary/20">
                        <ul class="text-sm text-gray-300 space-y-1">
                            <li class="flex items-center">
                                <svg class="w-4 h-4 text-secondary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Looks like a regular mobile game
                            </li>
                            <li class="flex items-center">
                                <svg class="w-4 h-4 text-secondary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Hidden emergency trigger mechanism
                            </li>
                            <li class="flex items-center">
                                <svg class="w-4 h-4 text-secondary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Instantly alerts emergency contacts
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Emergency Modal -->
<div id="emergencyModal" class="fixed inset-0 flex items-center justify-center hidden z-50">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
    <!-- Modal Content -->
    <div class="relative bg-neutral-light rounded-xl shadow-2xl w-full max-w-md mx-auto p-8 border border-accent/20">
        <!-- Close Button -->
        <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        <!-- Modal Body -->
        <div class="text-center">
            <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-red-500/20 flex items-center justify-center">
                <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-white mb-4">Emergency Alert</h2>
            <p class="text-gray-300 mb-6">
                Are you sure you want to send an emergency alert? This will immediately notify all your emergency contacts with your current location.
            </p>
        </div>
        <!-- Action Buttons -->
        <div class="flex gap-4">
            <button id="cancelBtn" class="flex-1 px-6 py-3 bg-neutral border border-accent/20 text-white rounded-xl hover:bg-neutral-dark transition-colors">
                Cancel
            </button>
            <button id="confirmBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-colors">
                Confirm
            </button>
        </div>
    </div>
</div>

<script>
    let latitude = '';
    let longitude = '';
    navigator.geolocation.getCurrentPosition((position) => {
        latitude = position.coords.latitude;
        longitude = position.coords.longitude;
        return latitude, longitude;
    });

    let emergency_contacts_list = JSON.parse('{{ emergency_contacts_list|escapejs }}');

    let contact_name = '';
    let phone_number = '';
    const first_name = "{{first_name}}"

    //Emergency Button
    const emergencyBtnDesktop = document.getElementById('emergencyBtnDesktop');
    const emergencyModal = document.getElementById('emergencyModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const confirmBtn = document.getElementById('confirmBtn');

    // Open modal
    const openModal = () => {
        emergencyModal.classList.remove('hidden');
    };

    // Close modal
    const closeModal = () => {
        emergencyModal.classList.add('hidden');
    };

    // Attach event listeners to both buttons
    if (emergencyBtnDesktop) {
        emergencyBtnDesktop.addEventListener('click', openModal);
    }

    // Close modal actions
    if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);

    // Confirm action
    if (confirmBtn) {
        confirmBtn.addEventListener('click', () => {
            // For loop within event listener to count the contacts and make individual request for each
            for (let i = 0; i < emergency_contacts_list.length; i++) {
                contact_name = emergency_contacts_list[i].name;
                phone_number = emergency_contacts_list[i].phone_number;
                console.log(`Name: ${contact_name}, Number: ${phone_number}`);
                console.log("Button clicked!");
                if (latitude && longitude) {
                    fetch(`{% url 'home_page:emergency_message_coordinates' %}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            recipient: phone_number,
                            sender: first_name,
                            contact: contact_name,
                            latitude_info: latitude,
                            longitude_info: longitude
                        }),
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('Response:', data);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                } else {
                    fetch(`{% url 'home_page:emergency_message' %}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            recipient: phone_number,
                            sender: first_name,
                            contact: contact_name,
                        }),
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('Response:', data);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }
            }
            alert('Emergency alert has been sent!');
            closeModal();
        });
    }

    // Close modal when clicking outside
    if (emergencyModal) {
        emergencyModal.addEventListener('click', (e) => {
            if (e.target === emergencyModal) {
                closeModal();
            }
        });
    }
</script>
{% endblock %}